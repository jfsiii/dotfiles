#!/usr/bin/env bash

## bash-it
THISDIR=$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )
source $THISDIR/colors.bash
source $THISDIR/scm_prompt.bash

SCM_THEME_PROMPT_DIRTY="${red}✗${normal}"
SCM_THEME_PROMPT_CLEAN="${green}✓${normal}"

function _bashit_prompt()
{
    # call function which creates the various `$SCM_*` variables
    scm_prompt_vars

    if [[ $SCM != $SCM_NONE ]]
    then
    	## put trailing space here
        local scm_info="$blue[$SCM_BRANCH @ ${SCM_CHANGE:0:7}]${normal} $SCM_STATE ${normal}";
    fi

    local dir="${underline_yellow}\w${normal}"
    local end="${green}‣${normal}"

    # something like `± ~/.bash_it [master @ b59ee65] ✗ → `
    # `$scm_info$end` is b/c `$scm_info` might be empty
    # which would result in `$dir[space][space]$end`
    PS1="$SCM_CHAR $dir $scm_info$end "
}

## powerline-shell
function _powerline_prompt() {
    PS1="$(~/powerline-shell.py $? 2> /dev/null)"
}

PROMPT_COMMAND=_powerline_prompt
